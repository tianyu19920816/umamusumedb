---
import Layout from '@/layouts/Layout.astro';
import HeaderJa from '@/components/HeaderJa.astro';
import { characters } from '@/lib/static-content';
import { Star, Zap, Heart, Brain, Shield, TrendingUp, Trophy, Award } from 'lucide-react';

export function getStaticPaths() {
  return characters.map((character) => ({
    params: { id: character.id },
    props: { character },
  }));
}

const { character } = Astro.props;

// Helper function to get aptitude color
function getAptitudeColor(value: string) {
  switch(value) {
    case 'S': return 'text-red-500 font-bold';
    case 'A': return 'text-orange-500 font-bold';
    case 'B': return 'text-yellow-500';
    case 'C': return 'text-green-500';
    case 'D': return 'text-blue-500';
    case 'E': return 'text-gray-500';
    case 'F': return 'text-gray-400';
    case 'G': return 'text-gray-300';
    default: return 'text-gray-500';
  }
}

function getBestStat(attributes: any) {
  if (!attributes) return 'ã‚¹ãƒ”ãƒ¼ãƒ‰';
  const stats = ['speed', 'stamina', 'power', 'guts', 'wisdom'];
  const statNames: Record<string, string> = {
    speed: 'ã‚¹ãƒ”ãƒ¼ãƒ‰',
    stamina: 'ã‚¹ã‚¿ãƒŸãƒŠ',
    power: 'ãƒ‘ãƒ¯ãƒ¼',
    guts: 'æ ¹æ€§',
    wisdom: 'è³¢ã•'
  };
  let best = 'speed';
  let max = 0;
  for (const stat of stats) {
    if (attributes[stat] > max) {
      max = attributes[stat];
      best = stat;
    }
  }
  return statNames[best];
}

function getBestDistance(aptitudes: any) {
  if (!aptitudes) return 'ãƒã‚¤ãƒ«';
  const distances = ['sprint', 'mile', 'medium', 'long'];
  const distNames: Record<string, string> = {
    sprint: 'çŸ­è·é›¢',
    mile: 'ãƒã‚¤ãƒ«',
    medium: 'ä¸­è·é›¢',
    long: 'é•·è·é›¢'
  };
  const values: Record<string, number> = { 'S': 7, 'A': 6, 'B': 5, 'C': 4, 'D': 3, 'E': 2, 'F': 1, 'G': 0 };
  let best = 'mile';
  let maxScore = 0;
  for (const dist of distances) {
    const score = values[aptitudes[dist]] || 0;
    if (score > maxScore) {
      maxScore = score;
      best = dist;
    }
  }
  return distNames[best];
}

function getBestStrategy(aptitudes: any) {
  if (!aptitudes) return 'å·®ã—';
  const strategies = ['leader', 'better', 'chaser'];
  const stratNames: Record<string, string> = {
    leader: 'é€ƒã’',
    better: 'å·®ã—',
    chaser: 'è¿½è¾¼'
  };
  const values: Record<string, number> = { 'S': 7, 'A': 6, 'B': 5, 'C': 4, 'D': 3, 'E': 2, 'F': 1, 'G': 0 };
  let best = 'better';
  let maxScore = 0;
  for (const strat of strategies) {
    const score = values[aptitudes[strat]] || 0;
    if (score > maxScore) {
      maxScore = score;
      best = strat;
    }
  }
  return stratNames[best];
}
---

<Layout title={`${character.name_jp || character.name_en} - ã‚¦ãƒå¨˜DB`}>
  <HeaderJa />
  
  <main class="container mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav class="text-sm mb-6">
      <ol class="flex items-center space-x-2">
        <li><a href="/ja" class="text-uma-primary hover:underline">ãƒ›ãƒ¼ãƒ </a></li>
        <li class="text-gray-400">/</li>
        <li><a href="/ja/characters" class="text-uma-primary hover:underline">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</a></li>
        <li class="text-gray-400">/</li>
        <li class="text-gray-600">{character.name_jp || character.name_en}</li>
      </ol>
    </nav>

    <div class="grid lg:grid-cols-3 gap-8">
      <!-- Left Column - Character Image and Basic Info -->
      <div class="lg:col-span-1">
        <div class="glass rounded-xl p-6 sticky top-20">
          <!-- Character Image -->
          <div class="relative aspect-[3/4] bg-gradient-to-br from-uma-primary/20 to-uma-secondary/20 rounded-lg mb-4 overflow-hidden">
            {character.image_url ? (
              <img 
                src={character.image_url} 
                alt={character.name_jp}
                class="absolute inset-0 w-full h-full object-cover object-top"
                loading="lazy"
              />
            ) : (
              <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-center">
                  <div class="w-32 h-32 mx-auto mb-4 bg-gradient-to-br from-uma-primary to-uma-secondary rounded-full flex items-center justify-center">
                    <Trophy className="w-16 h-16 text-white" />
                  </div>
                  <p class="text-gray-500">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒ</p>
                </div>
              </div>
            )}
          </div>

          <!-- Basic Info -->
          <div class="space-y-3">
            <h1 class="text-2xl font-display gradient-text">{character.name_jp || character.name_en}</h1>
            <p class="text-lg text-gray-600">{character.name_en}</p>
            
            <!-- Rarity -->
            <div class="flex items-center gap-2">
              <span class="text-sm text-gray-600">ãƒ¬ã‚¢ãƒªãƒ†ã‚£:</span>
              <div class="flex">
                {Array.from({ length: character.rarity }, () => (
                  <Star className="w-5 h-5 fill-uma-accent text-uma-accent" />
                ))}
              </div>
            </div>

            <!-- Birthday -->
            <div class="flex items-center gap-2">
              <span class="text-sm text-gray-600">èª•ç”Ÿæ—¥:</span>
              <span class="font-medium">{character.birthday || 'ä¸æ˜'}</span>
            </div>

            <!-- CV -->
            <div class="flex items-center gap-2">
              <span class="text-sm text-gray-600">å£°å„ª:</span>
              <span class="font-medium">{character.cv || 'ä¸æ˜'}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column - Detailed Stats -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Stats Section -->
        <div class="glass rounded-xl p-6">
          <h2 class="text-xl font-display mb-4 flex items-center gap-2">
            <TrendingUp className="w-5 h-5 text-uma-primary" />
            åŸºæœ¬ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
          </h2>
          
          <div class="grid md:grid-cols-2 gap-4">
            <div class="space-y-3">
              <div class="flex items-center gap-3">
                <span class="text-2xl">âš¡</span>
                <div class="flex-1">
                  <div class="flex justify-between mb-1">
                    <span class="text-sm font-medium">ã‚¹ãƒ”ãƒ¼ãƒ‰</span>
                    <span class="text-sm font-bold">{character.attributes?.speed || 0}</span>
                  </div>
                  <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="bg-red-500 h-full transition-all duration-500" style={{width: `${((character.attributes?.speed || 0) / 120) * 100}%`}}></div>
                  </div>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-2xl">â¤ï¸</span>
                <div class="flex-1">
                  <div class="flex justify-between mb-1">
                    <span class="text-sm font-medium">ã‚¹ã‚¿ãƒŸãƒŠ</span>
                    <span class="text-sm font-bold">{character.attributes?.stamina || 0}</span>
                  </div>
                  <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="bg-green-500 h-full transition-all duration-500" style={{width: `${((character.attributes?.stamina || 0) / 120) * 100}%`}}></div>
                  </div>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-2xl">ğŸ’ª</span>
                <div class="flex-1">
                  <div class="flex justify-between mb-1">
                    <span class="text-sm font-medium">ãƒ‘ãƒ¯ãƒ¼</span>
                    <span class="text-sm font-bold">{character.attributes?.power || 0}</span>
                  </div>
                  <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="bg-orange-500 h-full transition-all duration-500" style={{width: `${((character.attributes?.power || 0) / 120) * 100}%`}}></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="space-y-3">
              <div class="flex items-center gap-3">
                <span class="text-2xl">ğŸ”¥</span>
                <div class="flex-1">
                  <div class="flex justify-between mb-1">
                    <span class="text-sm font-medium">æ ¹æ€§</span>
                    <span class="text-sm font-bold">{character.attributes?.guts || 0}</span>
                  </div>
                  <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="bg-purple-500 h-full transition-all duration-500" style={{width: `${((character.attributes?.guts || 0) / 120) * 100}%`}}></div>
                  </div>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-2xl">ğŸ§ </span>
                <div class="flex-1">
                  <div class="flex justify-between mb-1">
                    <span class="text-sm font-medium">è³¢ã•</span>
                    <span class="text-sm font-bold">{character.attributes?.wisdom || 0}</span>
                  </div>
                  <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="bg-blue-500 h-full transition-all duration-500" style={{width: `${((character.attributes?.wisdom || 0) / 120) * 100}%`}}></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Aptitudes Section -->
        <div class="glass rounded-xl p-6">
          <h2 class="text-xl font-display mb-4 flex items-center gap-2">
            <Award className="w-5 h-5 text-uma-primary" />
            ãƒ¬ãƒ¼ã‚¹é©æ€§
          </h2>
          
          <div class="grid md:grid-cols-2 gap-6">
            <!-- Distance Aptitudes -->
            <div>
              <h3 class="font-semibold mb-3 text-gray-700">è·é›¢é©æ€§</h3>
              <div class="space-y-2">
                <div class="flex justify-between items-center">
                  <span class="text-sm">çŸ­è·é›¢</span>
                  <span class={`${getAptitudeColor(character.aptitudes?.sprint || 'G')} text-lg`}>{character.aptitudes?.sprint || 'G'}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">ãƒã‚¤ãƒ«</span>
                  <span class={`${getAptitudeColor(character.aptitudes?.mile || 'G')} text-lg`}>{character.aptitudes?.mile || 'G'}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">ä¸­è·é›¢</span>
                  <span class={`${getAptitudeColor(character.aptitudes?.medium || 'G')} text-lg`}>{character.aptitudes?.medium || 'G'}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">é•·è·é›¢</span>
                  <span class={`${getAptitudeColor(character.aptitudes?.long || 'G')} text-lg`}>{character.aptitudes?.long || 'G'}</span>
                </div>
              </div>
            </div>

            <!-- Track Aptitudes -->
            <div>
              <h3 class="font-semibold mb-3 text-gray-700">é¦¬å ´ãƒ»æˆ¦ç•¥é©æ€§</h3>
              <div class="space-y-2">
                <div class="flex justify-between items-center">
                  <span class="text-sm">èŠ</span>
                  <span class={`${getAptitudeColor(character.aptitudes?.turf || 'G')} text-lg`}>{character.aptitudes?.turf || 'G'}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">ãƒ€ãƒ¼ãƒˆ</span>
                  <span class={`${getAptitudeColor(character.aptitudes?.dirt || 'G')} text-lg`}>{character.aptitudes?.dirt || 'G'}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">é€ƒã’</span>
                  <span class={`${getAptitudeColor(character.aptitudes?.leader || 'G')} text-lg`}>{character.aptitudes?.leader || 'G'}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">å·®ã—</span>
                  <span class={`${getAptitudeColor(character.aptitudes?.better || 'G')} text-lg`}>{character.aptitudes?.better || 'G'}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm">è¿½è¾¼</span>
                  <span class={`${getAptitudeColor(character.aptitudes?.chaser || 'G')} text-lg`}>{character.aptitudes?.chaser || 'G'}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Skills Section -->
        {character.skills && character.skills.length > 0 && (
          <div class="glass rounded-xl p-6">
            <h2 class="text-xl font-display mb-4 flex items-center gap-2">
              <Zap className="w-5 h-5 text-uma-primary" />
              å›ºæœ‰ã‚¹ã‚­ãƒ«
            </h2>
            
            <div class="grid gap-3">
              {character.skills.map((skill: string) => (
                <div class="flex items-center gap-3 p-3 bg-white rounded-lg">
                  <div class="w-10 h-10 bg-gradient-to-br from-uma-accent/20 to-uma-accent/10 rounded-full flex items-center justify-center">
                    <Zap className="w-5 h-5 text-uma-accent" />
                  </div>
                  <div>
                    <h3 class="font-semibold">{skill}</h3>
                    <p class="text-sm text-gray-600">å›ºæœ‰ã‚¹ã‚­ãƒ«åŠ¹æœã®èª¬æ˜</p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        <!-- Training Tips -->
        <div class="glass rounded-xl p-6">
          <h2 class="text-xl font-display mb-4 flex items-center gap-2">
            <Shield className="w-5 h-5 text-uma-primary" />
            è‚²æˆã®ã‚³ãƒ„
          </h2>
          
          <div class="prose prose-sm max-w-none text-gray-600">
            <p>{character.name_jp || character.name_en}ã®é©æ€§ã«åŸºã¥ã„ãŸæ¨å¥¨è‚²æˆæˆ¦ç•¥:</p>
            <ul>
              <li>æœ€é©ãªè‚²æˆæ–¹é‡: <strong>{getBestStat(character.attributes)}</strong>ç‰¹åŒ–</li>
              <li>æ¨å¥¨è·é›¢: <strong>{getBestDistance(character.aptitudes)}</strong></li>
              <li>æ¨å¥¨æˆ¦ç•¥: <strong>{getBestStrategy(character.aptitudes)}</strong></li>
              <li>é•·æ‰€ã‚’æ´»ã‹ã™ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ã¨çµ„ã¿åˆã‚ã›ã‚‹</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </main>

  <style>
    .prose ul {
      @apply list-disc list-inside space-y-1;
    }
  </style>
</Layout>